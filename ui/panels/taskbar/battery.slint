
import { ProgressIndicator } from "std-widgets.slint";

export enum BatterState {
    Charging,
    Draining,
    Unknown,
    Critical,
    Low,
    S1,
    S2,
    S3,
    S4,
    S5,
    S6,
    Full,
    ConnectedNotCharging,
}

export struct BatteryData {
    percentage: int,
    state: BatterState,
    icon: string,
}

export component Battery {
    in-out property <BatteryData> state: {
        percentage: 0,
        state: BatterState.Unknown,
        icon: "",
    };

    pure function get-color(s: BatterState) -> color {
        if (s == BatterState.Unknown) {
            return #a855f7;
        }
        if (s == BatterState.Critical) {
            return #ef4444;
        }
        if (s == BatterState.Low) {
            return #f97316;
        }
        if (s == BatterState.S1) {
            return #eab308;
        }
        if (s == BatterState.S2) {
            return #ffffff;
        }
        if (s == BatterState.S3) {
            return #ffffff;
        }
        if (s == BatterState.S4) {
            return #ffffff;
        }
        if (s == BatterState.S5) {
            return #ffffff;
        }
        if (s == BatterState.S6) {
            return #ffffff;
        }
        if (s == BatterState.Full) {
            return #22c55e;
        }
        if (s == BatterState.Charging) {
            return #3b82f6;
        }
        if (s == BatterState.ConnectedNotCharging) {
            return #a855f7;
        }
        return #ffffff;
    }

    // Component sizing - fits content
    HorizontalLayout {
        spacing: 6px;
        alignment: center;

        // Circular indicator with icon
        Rectangle {
            width: 40px;
            height: 40px;
            
            // Background circle
            Rectangle {
                width: 100%;
                height: 100%;
                border-radius: 20px;
                background: #3d3d3d;
            }

            // Battery Level Arc (Circular Progress)
            Path {
                width: 100%;
                height: 100%;
                viewbox-width: 100;
                viewbox-height: 100;
                commands: {
                    if (root.state.percentage == 0) {
                        ""
                    } else if (root.state.percentage == 100) {
                        "M 50 10 A 40 40 0 1 1 49.99 10"
                    } else {
                        "M 50 10 A 40 40 0 " + (root.state.percentage > 50 ? "1" : "0") + " 1 " + (50 + 40 * sin(root.state.percentage * 3.6deg)) + " " + (50 - 40 * cos(root.state.percentage * 3.6deg))
                    }
                };
                stroke: get-color(root.state.state);
                stroke-width: 2px;
                fill: transparent;
            }
            
            // Icon (SVG Path) in Center
            Path {
                commands: root.state.icon;
                width: 20px;
                height: 20px;
                x: (parent.width - self.width) / 2;
                y: (parent.height - self.height) / 2;
                viewbox-width: 24;
                viewbox-height: 24;
                fill: get-color(root.state.state);
                stroke-width: 0;
            }
        }

        // Percentage text
        Text {
            text: root.state.percentage + "%";
            font-size: 12px;
            color: #f8f8f2;
            vertical-alignment: center;
            font-weight: 600;
        }
    }
}
